<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android">

    <!-- Plugin Module Manifest -->
    <!-- All plugin-related services are declared here -->
    <!-- Security: Explicitly disable backup to prevent data leakage -->
    <application android:allowBackup="false">
        <!-- Hardware Bridge Service - Provides hardware access to isolated sandbox -->
        <!-- Runs in main process with all app permissions -->
        <service
            android:name="com.ble1st.connectias.hardware.HardwareBridgeService"
            android:enabled="true"
            android:exported="false" />

        <!-- File System Bridge Service - Provides file system access to isolated sandbox -->
        <!-- Runs in main process with controlled file access -->
        <service
            android:name="com.ble1st.connectias.core.plugin.FileSystemBridgeService"
            android:enabled="true"
            android:exported="false" />

        <!-- Plugin Messaging Service - Provides message routing between plugins -->
        <!-- Runs in main process as message broker -->
        <service
            android:name="com.ble1st.connectias.plugin.messaging.PluginMessagingService"
            android:enabled="true"
            android:exported="false" />

        <!-- Plugin Sandbox Service - Runs in SEPARATE process for crash isolation -->
        <!-- isolatedProcess="true" = TRUE OS-Level isolation (no app permissions) -->
        <!-- Security: Hardware access controlled via Hardware Bridge + PermissionManager -->
        <service
            android:name="com.ble1st.connectias.core.plugin.PluginSandboxService"
            android:process=":plugin_sandbox"
            android:isolatedProcess="true"
            android:exported="false" />

        <!-- Plugin UI Service - Runs in SEPARATE process for UI rendering -->
        <!-- Three-Process Architecture: Main + Sandbox (isolated) + UI (non-isolated) -->
        <!-- isolatedProcess="false" = Can access UI framework (VirtualDisplay, etc.) -->
        <!-- Security: Only renders UI, no hardware access or business logic -->
        <service
            android:name="com.ble1st.connectias.core.plugin.ui.PluginUIService"
            android:process=":plugin_ui"
            android:isolatedProcess="false"
            android:exported="false"
            android:enabled="true" />

        <!-- Plugin UI Activity - Hosts fragments in UI Process -->
        <!-- Used for rendering plugin UI in isolated UI Process -->
        <!-- Security: singleTop instead of singleTask to prevent task hijacking -->
        <activity
            android:name="com.ble1st.connectias.core.plugin.ui.PluginUIActivity"
            android:process=":plugin_ui"
            android:exported="false"
            android:theme="@android:style/Theme.NoTitleBar.Fullscreen"
            android:launchMode="singleTop"
            android:excludeFromRecents="true"
            android:windowSoftInputMode="adjustResize|stateHidden"
            android:configChanges="keyboard|keyboardHidden|orientation|screenSize" />

        <!-- SAF File Picker Activity - Main Process -->
        <!-- Transparent Activity for handling Storage Access Framework file creation -->
        <!-- Started by FileSystemBridgeService when plugins request SAF file saving -->
        <!-- Security: singleTop instead of singleTask to prevent task hijacking -->
        <activity
            android:name="com.ble1st.connectias.core.plugin.SAFFilePickerActivity"
            android:exported="false"
            android:theme="@android:style/Theme.Translucent.NoTitleBar"
            android:launchMode="singleTop"
            android:excludeFromRecents="true" />
    </application>

</manifest>
